<div class="container show-image-comment">
  <p id="notice"><%= notice %></p>

  <div class="form-group-lg">
    <div class="show-address">
      <%= @image.address %>
    </div>
    <div class="show-info">
      <%= t "upload_by" %> : 
      <%= link_to @image.user.name, "#", class: "btn-link" %>
    </div>
    <div class="show-info">
      <%= t "description" %> : 
      <% if @image.description.length > 100 %>
        <%= truncate @image.description, length: 100 %>
        <%= link_to "read more", "", class: "read-more-#{@image.id} btn-link" %>
        <script>
          $(".read-more-<%= @image.id %>").on("click", function(e) {
            e.preventDefault()
            $(this).parent().html("<%= t "description" %> : <%= escape_javascript @image.description %>")
          })
        </script>
      <% else %>
        <%= @image.description %>
      <% end %>
    </div>
    <div class="show-image">
      <%= image_tag @image.image, class: "img-responsive img-rounded" %>
    </div>
    <div class="col-md-3"></div>
    <div class="show-like col-md-3">
      <% if LikeImage.where(user_id: current_user.id, image_id: @image.id).exists? %><!-- if current user liked this image -->
        <% LikeImage.where(user_id: current_user.id, image_id: @image.id).each do |like| %>
          <%= link_to t("like"), like_image_path(like.id), method: :delete, class: "btn btn-success" %>                       <!-- cannot like anymore -->
        <% end %>
      <% else %>                                                                      <!-- if current user haven't liked this image -->
        <%= form_for(@like_image) do |f| %>
         <%= f.hidden_field :image_id, value: @image.id %>
         <%= f.submit t("like"), class: "btn btn-primary" %>                          <!-- like button -->
        <% end %>
      <% end %>
      </div>
    <div class="show-category col-md-6">
      <%= t "category" %> : 
      <%= link_to @image.category.name, "#", class: "btn-link" %>
    </div>
    <div class="show-info show-number-like">
      <%= t "like_number" %> : 
      <%= link_to @image.like_number, "#", class: "btn-link" %>
    </div>
  </div>
  
  <div class="actions">
    <% if current_user == @image.user %>
      <%= link_to t("edit"), edit_image_path(@image),
        class: "btn btn-info" %>
    <% end %>
    <%= link_to t("back"), images_path, class: "btn btn-info" %>
  </div>

  <h2><%= t "comment" %></h2>
  <%= form_for(@comment) do |f| %>
    <div class="form-group form-group-lg">
      <div class="field col-sm-5 control-label" >
        <div class="col-xs-50" >
          <%= f.text_field :content, class: "form-control" %>
        </div>
        <%= f.hidden_field :image_id, value: @image.id %>
        <%= f.hidden_field :parent_id, value: 0 %>
      </div>
      <div class="action" >
        <%= f.submit t("comment"), class: "btn btn-primary" %>
      </div>
    </div>
  <% end %>
  <br>
  <div class="show-comment">
    <h2><%= t "list_comments" %></h2>
    <% @image.comment.each do |image_comment| %>
      <div class="show-parent-comment">
        <div class="col-md-1">
          <% unless image_comment.user.avatar %>
            <%= image_tag "profile.jpg", class: "img-responsive" %>
          <% else %>
            <%= image_tag image_comment.user.avatar, class: "img-responsive" %>
          <% end %>
        </div>
        <div class="col-md-11"><%= image_comment.user.name %> : 
          <%= image_comment.content %></div>
        <br><br>
        <div class="action">
          <i class="fa fa-thumbs-up" aria-hidden="true"></i>
          <%= link_to t("like"), "#", class: "btn btn-link" %>
          <i class="fa fa-reply" aria-hidden="true"></i>
          <%= link_to t("reply"), "#", class: "btn btn-link" %>
        </div>
        </br>
      </div>
      <% if @reply %>
        <div class="show-reply-comment">
          <%= @reply.comment.each do |reply| %>
            <% unless reply.user.avatar %>
              <div class="show-avatar-comment">
                <%= image_tag "profile.jpg" %></div>
            <% else %>
              <div class="show-avatar-comment">
                <%= image_tag reply.user.avatar %></div>
            <% end %>
            <strong><%= reply.user.name %> : </strong>
            <%= reply.content %>
            <br>
            <div class="action">
              <%= link_to t("like"), "#", class: "btn btn-link" %>
            </div>
          <% end %>
        </div>
      <% end %>
    <% end %>
  </div>
</div>
<%= render "pages/image_share" %>
<%= render "pages/about" if request.fullpath == root_path %>
